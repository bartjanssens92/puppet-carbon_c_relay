# Puppet_carbon_c_relay

Module to install and configure [carbon-c-relay](https://github.com/grobian/carbon-c-relay).

This modules was only tested on Centos 7.8 and with basic config.

## Config Example

The main idea is to be able to reuse configuration of the carbon-caches. Hence the following example shows configuration that is passed via hiera:

```yaml
carbon::carbon_caches: &carbon_caches
  a:
    line_receiver_port: 2103
    cache_query_port: 7102
    pickle_receiver_port: 2104
  b:
    line_receiver_port: 2203
    cache_query_port: 7202
    pickle_receiver_port: 2204
  c:
    line_receiver_port: 2303
    cache_query_port: 7302
    pickle_receiver_port: 2304

carbon_c_relay::clusters:
  graphite:
    algorithm: carbon_ch
    caches: *carbon_caches
carbon_c_relay::matches:
  '*':
    action: 'send to graphite'
    stop: true
```

The config above will render the following configuration for the relay:
```bash
# File managed by puppet ( carbon_c_relay )

# Fragment generated by graphite
cluster graphite
    carbon_ch
        127.0.0.1:2103=a
        127.0.0.1:2203=b
        127.0.0.1:2303=c
    ;

# Generated by *
match *
    send to graphite
    stop
    ;

```

## TO-DO

At this time the module only supports simple configuration, meaning: aggregations, rewrites or more complex match rules are not supported.
The module also assumes that the caches are located on the same host, prefixing the port with '127.0.0.1'.
